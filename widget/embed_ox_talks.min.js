/*!  - v - 2015-02-04
https://github.com/ox-it/talks.ox-js-widget
var OX_TALKS_URL_STEM="https://talks.ox.ac.uk/api/talks/search?",oxtalks={get_person_titles:function(a){var b=a.map(function(a){return a.name+" ("+a.bio+")"});return b.length<=0&&b.push("TBA"),b.join(", ")},build_location:function(a){return a?"<a href="+a.map_link+">"+a.name+"</a>":"TBA"},build_title:function(a){var b=a.title?a.title:"TBA";return"<a href='"+a._links.talks_page.href+"'>"+b+"</a>"},buildTable:function(a,b){b.empty();var c=$("table",b);c.length?c.empty():(c=$("<table></table>"),b.append(c)),c.append($("<tr><th>Date</th><th>Speakers</th><th>Title</th><th>Venue</th></tr>"));for(var d=0;d<a._embedded.talks.length;d++){talk=a._embedded.talks[d];var e=this.build_location(talk._embedded.venue),f=this.build_title(talk);c.append($("<tr><td>"+talk.formatted_date+"</td><td>"+this.get_person_titles(talk._embedded.speakers)+"</td><td>"+f+"</td><td>"+e+"</td></tr>"))}if(a._links.prev){var g=$('<a href="#">Prev</a>');b.append(g),g.on("click",function(b){var c=$(b.target).parent();this.queryURL(a._links.prev.href,this.buildTable,c)}.bind(this))}if(a._links.next){var h=$('<a href="#">Next</a>');b.append(h),h.on("click",function(b){var c=$(b.target).parent();this.queryURL(a._links.next.href,this.buildTable,c)}.bind(this))}},buildList:function(a,b){b.empty();for(var c=0;c<a._embedded.talks.length;c++){talk=a._embedded.talks[c];var d=this.build_title(talk);header=$("<h3>"+d+"</h3>"),b.append(header),description=$("<p>"),description.html(talk.description),b.append(description),bullets=$("<ul>"),bullets.append($("<li>Speaker: "+this.get_person_titles(talk._embedded.speakers)+"</li>")),start_time=new Date(talk.start),end_time=new Date(talk.end),bullets.append($("<li>"+talk.formatted_date+"</li>"));var e=this.build_location(talk._embedded.venue);bullets.append($("<li>"+e+"</li>")),b.append(bullets)}if(a._links.prev){var f=$('<a href="#">Prev</a>');b.append(f),f.on("click",function(b){var c=$(b.target).parent();this.queryURL(a._links.prev.href,this.buildList,c)}.bind(this))}if(a._links.next){var g=$('<a href="#">Next</a>');b.append(g),g.on("click",function(b){var c=$(b.target).parent();this.queryURL(a._links.next.href,this.buildList,c)}.bind(this))}},queryTalks:function(a,b,c){var d=[];a.from&&d.push("from="+a.from),a.to&&d.push("to="+a.to),d=d.concat(this.buildTermsFromArray(a.speakers,"speaker")),d=d.concat(this.buildTermsFromArray(a.venues,"venue")),d=d.concat(this.buildTermsFromArray(a.organising_departments,"organising_department")),d=d.concat(this.buildTermsFromArray(a.topics,"topic")),a.page_size&&d.push("count="+a.page_size);var e=a.url?a.url:OX_TALKS_URL_STEM,f=e+d.join("&");this.queryURL(f,b,c)},queryURL:function(a,b,c){$.ajax({url:a,type:"get",dataType:"json",success:function(a){b.call(this,a,c)}.bind(this),failure:function(){console.log("AJAX call failed")}})},buildTermsFromArray:function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)c.push(b+"="+a[d]);return c}return[]},createContainer:function(){var a="oxtalks",b=$("<div id="+a+"></div>");return $("body").append(b),"#"+a},showTable:function(a,b){b||(b=this.createContainer()),this.queryTalks(a,this.buildTable,$(b))},showList:function(a,b){b||(b=this.createContainer()),this.queryTalks(a,this.buildList,$(b))}};